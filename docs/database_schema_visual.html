<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Schema - Visual ER Diagrams</title>
    <style>
        @page {
            size: A4 landscape;
            margin: 10mm;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 9pt;
            line-height: 1.3;
            color: #333;
            background: #f5f5f5;
        }

        .page {
            background: white;
            max-width: 1400px;
            margin: 20px auto;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            page-break-after: always;
        }

        h1 {
            color: #2c3e50;
            font-size: 32pt;
            margin-bottom: 15px;
            border-bottom: 4px solid #3498db;
            padding-bottom: 10px;
        }

        h2 {
            color: #2980b9;
            font-size: 20pt;
            margin: 20px 0 15px 0;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 5px;
        }

        h3 {
            color: #34495e;
            font-size: 14pt;
            margin: 15px 0 10px 0;
        }

        /* ER Diagram Styles */
        .er-diagram {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            position: relative;
            overflow: visible;
        }

        .er-container {
            display: grid;
            gap: 30px;
            position: relative;
            min-height: 400px;
        }

        /* Table box in ER diagram */
        .er-table {
            background: white;
            border: 2px solid #34495e;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
            width: 280px;
        }

        .er-table-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px;
            font-weight: bold;
            font-size: 11pt;
            text-align: center;
        }

        .er-table-body {
            padding: 0;
        }

        .er-column {
            padding: 6px 10px;
            border-bottom: 1px solid #ecf0f1;
            font-size: 8pt;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .er-column:last-child {
            border-bottom: none;
        }

        .er-column.pk {
            background: #ffe8e8;
            font-weight: bold;
        }

        .er-column.fk {
            background: #fff3cd;
        }

        .er-column-name {
            flex: 1;
            font-family: 'Courier New', monospace;
        }

        .er-column-type {
            color: #e74c3c;
            font-family: 'Courier New', monospace;
            font-size: 7pt;
            margin: 0 5px;
        }

        .er-key-icon {
            width: 16px;
            height: 16px;
            display: inline-block;
        }

        /* Relationship lines */
        .relationship-line {
            position: absolute;
            pointer-events: none;
        }

        svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .er-table {
            position: relative;
            z-index: 2;
        }

        /* Legend */
        .legend {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 9pt;
        }

        .legend-icon {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }

        .legend-icon.pk { background: #ffe8e8; border: 2px solid #e74c3c; }
        .legend-icon.fk { background: #fff3cd; border: 2px solid #f39c12; }
        .legend-icon.unique { background: #e8f4fd; border: 2px solid #3498db; }
        .legend-icon.index { background: #e8f8f5; border: 2px solid #16a085; }

        .relationship-legend {
            margin: 10px 0;
            display: flex;
            gap: 20px;
            font-size: 9pt;
        }

        .relationship-legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Metadata */
        .metadata {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .metadata-item {
            display: flex;
            flex-direction: column;
        }

        .metadata-label {
            font-weight: bold;
            color: #7f8c8d;
            font-size: 8pt;
            text-transform: uppercase;
        }

        .metadata-value {
            color: #2c3e50;
            font-size: 10pt;
            font-weight: 600;
        }

        /* Grid layouts for different subsystems */
        .core-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 40px 30px;
        }

        .social-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 40px 30px;
        }

        .groups-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 40px 30px;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 28pt;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 9pt;
            opacity: 0.9;
        }

        @media print {
            body {
                background: white;
            }

            .page {
                box-shadow: none;
                margin: 0;
                max-width: 100%;
            }
        }

        /* Special positioning for complex diagrams */
        .positioned-table {
            position: absolute;
        }
    </style>
</head>
<body>

<!-- COVER PAGE -->
<div class="page">
    <h1>Database Schema Documentation</h1>
    <h2 style="border: none; margin-top: 10px;">Entity-Relationship Diagrams</h2>

    <div style="text-align: center; margin: 40px 0;">
        <svg width="300" height="300" viewBox="0 0 300 300" style="position: relative; z-index: 1;">
            <!-- Central Database -->
            <circle cx="150" cy="150" r="60" fill="#3498db" opacity="0.2"/>
            <circle cx="150" cy="150" r="50" fill="#3498db"/>
            <text x="150" y="145" text-anchor="middle" fill="white" font-size="14" font-weight="bold">PostgreSQL</text>
            <text x="150" y="165" text-anchor="middle" fill="white" font-size="12">Database</text>

            <!-- Tables around -->
            <rect x="30" y="30" width="60" height="40" fill="#2ecc71" rx="5"/>
            <text x="60" y="55" text-anchor="middle" fill="white" font-size="10" font-weight="bold">Core</text>

            <rect x="210" y="30" width="60" height="40" fill="#e74c3c" rx="5"/>
            <text x="240" y="55" text-anchor="middle" fill="white" font-size="10" font-weight="bold">Social</text>

            <rect x="30" y="230" width="60" height="40" fill="#f39c12" rx="5"/>
            <text x="60" y="255" text-anchor="middle" fill="white" font-size="10" font-weight="bold">Groups</text>

            <rect x="210" y="230" width="60" height="40" fill="#9b59b6" rx="5"/>
            <text x="240" y="255" text-anchor="middle" fill="white" font-size="10" font-weight="bold">Location</text>

            <!-- Connection lines -->
            <line x1="90" y1="50" x2="110" y2="110" stroke="#95a5a6" stroke-width="2"/>
            <line x1="210" y1="50" x2="190" y2="110" stroke="#95a5a6" stroke-width="2"/>
            <line x1="90" y1="250" x2="110" y2="190" stroke="#95a5a6" stroke-width="2"/>
            <line x1="210" y1="250" x2="190" y2="190" stroke="#95a5a6" stroke-width="2"/>
        </svg>
    </div>

    <div class="metadata">
        <div class="metadata-item">
            <span class="metadata-label">Project</span>
            <span class="metadata-value">Posting System</span>
        </div>
        <div class="metadata-item">
            <span class="metadata-label">Database</span>
            <span class="metadata-value">PostgreSQL 15</span>
        </div>
        <div class="metadata-item">
            <span class="metadata-label">Total Tables</span>
            <span class="metadata-value">25</span>
        </div>
        <div class="metadata-item">
            <span class="metadata-label">Generated</span>
            <span class="metadata-value" id="generation-date"></span>
        </div>
    </div>

    <div class="stats-grid">
        <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <div class="stat-value">25</div>
            <div class="stat-label">Tables</div>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
            <div class="stat-value">32</div>
            <div class="stat-label">Functions</div>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
            <div class="stat-value">18</div>
            <div class="stat-label">Triggers</div>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
            <div class="stat-value">85+</div>
            <div class="stat-label">Indexes</div>
        </div>
    </div>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-icon pk"></div>
            <span>Primary Key</span>
        </div>
        <div class="legend-item">
            <div class="legend-icon fk"></div>
            <span>Foreign Key</span>
        </div>
        <div class="legend-item">
            <div class="legend-icon unique"></div>
            <span>Unique Constraint</span>
        </div>
        <div class="legend-item">
            <div class="legend-icon index"></div>
            <span>Indexed Column</span>
        </div>
    </div>

    <div class="relationship-legend">
        <div class="relationship-legend-item">
            <svg width="40" height="20">
                <line x1="0" y1="10" x2="40" y2="10" stroke="#3498db" stroke-width="2"/>
                <circle cx="40" cy="10" r="3" fill="#3498db"/>
            </svg>
            <span>One-to-Many</span>
        </div>
        <div class="relationship-legend-item">
            <svg width="40" height="20">
                <line x1="0" y1="10" x2="40" y2="10" stroke="#e74c3c" stroke-width="2"/>
                <circle cx="0" cy="10" r="3" fill="#e74c3c"/>
                <circle cx="40" cy="10" r="3" fill="#e74c3c"/>
            </svg>
            <span>Many-to-Many</span>
        </div>
        <div class="relationship-legend-item">
            <svg width="40" height="20">
                <line x1="0" y1="10" x2="40" y2="10" stroke="#2ecc71" stroke-width="2" stroke-dasharray="5,5"/>
            </svg>
            <span>Optional</span>
        </div>
    </div>
</div>

<!-- CORE SYSTEM ER DIAGRAM -->
<div class="page">
    <h2>Core System - Entity Relationship Diagram</h2>

    <div class="er-diagram">
        <svg width="100%" height="600" viewBox="0 0 1200 600" style="position: absolute;">
            <!-- users to posts -->
            <line x1="270" y1="180" x2="470" y2="180" stroke="#3498db" stroke-width="3" marker-end="url(#arrowblue)"/>
            <text x="350" y="170" fill="#3498db" font-size="11">1</text>
            <text x="450" y="170" fill="#3498db" font-size="11">*</text>
            <text x="340" y="200" fill="#7f8c8d" font-size="10">creates</text>

            <!-- users to comments -->
            <line x1="270" y1="220" x2="470" y2="360" stroke="#3498db" stroke-width="3" marker-end="url(#arrowblue)"/>
            <text x="290" y="240" fill="#3498db" font-size="11">1</text>
            <text x="450" y="350" fill="#3498db" font-size="11">*</text>

            <!-- posts to comments -->
            <line x1="600" y1="270" x2="600" y2="340" stroke="#3498db" stroke-width="3" marker-end="url(#arrowblue)"/>
            <text x="610" y="300" fill="#3498db" font-size="11">1</text>
            <text x="610" y="330" fill="#3498db" font-size="11">*</text>
            <text x="615" y="310" fill="#7f8c8d" font-size="10">has</text>

            <!-- posts to media -->
            <line x1="730" y1="200" x2="870" y2="200" stroke="#3498db" stroke-width="3" marker-end="url(#arrowblue)"/>
            <text x="760" y="190" fill="#3498db" font-size="11">1</text>
            <text x="850" y="190" fill="#3498db" font-size="11">*</text>
            <text x="780" y="220" fill="#7f8c8d" font-size="10">attachments</text>

            <!-- comments to media -->
            <line x1="730" y1="400" x2="900" y2="280" stroke="#3498db" stroke-width="3" marker-end="url(#arrowblue)"/>

            <!-- posts to reactions -->
            <line x1="680" y1="270" x2="900" y2="380" stroke="#3498db" stroke-width="3" marker-end="url(#arrowblue)"/>

            <!-- comments to reactions -->
            <line x1="730" y1="440" x2="900" y2="460" stroke="#3498db" stroke-width="3" marker-end="url(#arrowblue)"/>

            <!-- Arrow marker definition -->
            <defs>
                <marker id="arrowblue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                    <path d="M0,0 L0,6 L9,3 z" fill="#3498db"/>
                </marker>
                <marker id="arrowred" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                    <path d="M0,0 L0,6 L9,3 z" fill="#e74c3c"/>
                </marker>
            </defs>
        </svg>

        <div class="core-grid">
            <!-- users table -->
            <div class="er-table" style="position: absolute; left: 20px; top: 80px;">
                <div class="er-table-header">users</div>
                <div class="er-table-body">
                    <div class="er-column pk">
                        <span class="er-column-name">ðŸ”‘ id</span>
                        <span class="er-column-type">SERIAL</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">username</span>
                        <span class="er-column-type">VARCHAR(50)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">email</span>
                        <span class="er-column-type">VARCHAR(255)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">password_hash</span>
                        <span class="er-column-type">VARCHAR(255)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">first_name</span>
                        <span class="er-column-type">VARCHAR(100)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">last_name</span>
                        <span class="er-column-type">VARCHAR(100)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">avatar_url</span>
                        <span class="er-column-type">VARCHAR(500)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">is_active</span>
                        <span class="er-column-type">BOOLEAN</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">created_at</span>
                        <span class="er-column-type">TIMESTAMP</span>
                    </div>
                </div>
            </div>

            <!-- posts table -->
            <div class="er-table" style="position: absolute; left: 470px; top: 80px;">
                <div class="er-table-header">posts</div>
                <div class="er-table-body">
                    <div class="er-column pk">
                        <span class="er-column-name">ðŸ”‘ id</span>
                        <span class="er-column-type">SERIAL</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— user_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">content</span>
                        <span class="er-column-type">TEXT</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">privacy_level</span>
                        <span class="er-column-type">VARCHAR(20)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">is_published</span>
                        <span class="er-column-type">BOOLEAN</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">views_count</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">created_at</span>
                        <span class="er-column-type">TIMESTAMP</span>
                    </div>
                </div>
            </div>

            <!-- comments table -->
            <div class="er-table" style="position: absolute; left: 470px; top: 340px;">
                <div class="er-table-header">comments</div>
                <div class="er-table-body">
                    <div class="er-column pk">
                        <span class="er-column-name">ðŸ”‘ id</span>
                        <span class="er-column-type">SERIAL</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— user_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— post_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— parent_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">content</span>
                        <span class="er-column-type">TEXT</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">depth</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">created_at</span>
                        <span class="er-column-type">TIMESTAMP</span>
                    </div>
                </div>
            </div>

            <!-- media table -->
            <div class="er-table" style="position: absolute; left: 870px; top: 100px;">
                <div class="er-table-header">media</div>
                <div class="er-table-body">
                    <div class="er-column pk">
                        <span class="er-column-name">ðŸ”‘ id</span>
                        <span class="er-column-type">SERIAL</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— user_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— post_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— comment_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">file_url</span>
                        <span class="er-column-type">VARCHAR(500)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">media_type</span>
                        <span class="er-column-type">VARCHAR(20)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">mime_type</span>
                        <span class="er-column-type">VARCHAR(100)</span>
                    </div>
                </div>
            </div>

            <!-- reactions table -->
            <div class="er-table" style="position: absolute; left: 870px; top: 360px;">
                <div class="er-table-header">reactions</div>
                <div class="er-table-body">
                    <div class="er-column pk">
                        <span class="er-column-name">ðŸ”‘ id</span>
                        <span class="er-column-type">SERIAL</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— user_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— post_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— comment_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">emoji_name</span>
                        <span class="er-column-type">VARCHAR(50)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">emoji_unicode</span>
                        <span class="er-column-type">VARCHAR(20)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">created_at</span>
                        <span class="er-column-type">TIMESTAMP</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <h3>Core System Summary</h3>
    <p><strong>5 Tables:</strong> users, posts, comments, media, reactions</p>
    <p><strong>Key Features:</strong> User authentication, content creation, nested comments (self-referencing), media attachments, emoji reactions</p>
    <p><strong>Constraints:</strong> Media must belong to either a post OR comment (CHECK constraint). Reactions unique per user/emoji/target.</p>
</div>

<!-- SOCIAL FEATURES ER DIAGRAM -->
<div class="page">
    <h2>Social Features - Entity Relationship Diagram</h2>

    <div class="er-diagram">
        <svg width="100%" height="600" viewBox="0 0 1200 600">
            <!-- users to follows (follower) -->
            <line x1="270" y1="150" x2="470" y2="150" stroke="#3498db" stroke-width="3" marker-end="url(#arrowblue)"/>
            <text x="320" y="140" fill="#3498db" font-size="11">1</text>
            <text x="450" y="140" fill="#3498db" font-size="11">*</text>
            <text x="340" y="170" fill="#7f8c8d" font-size="10">follower_id</text>

            <!-- users to follows (following) -->
            <line x1="270" y1="200" x2="470" y2="200" stroke="#e74c3c" stroke-width="3" marker-end="url(#arrowred)"/>
            <text x="320" y="220" fill="#e74c3c" font-size="11">1</text>
            <text x="450" y="220" fill="#e74c3c" font-size="11">*</text>
            <text x="340" y="240" fill="#7f8c8d" font-size="10">following_id</text>

            <!-- users to shares -->
            <line x1="270" y1="280" x2="470" y2="380" stroke="#3498db" stroke-width="3" marker-end="url(#arrowblue)"/>
            <text x="290" y="300" fill="#3498db" font-size="11">1</text>
            <text x="450" y="370" fill="#3498db" font-size="11">*</text>

            <!-- posts to shares -->
            <line x1="880" y1="150" x2="730" y2="380" stroke="#3498db" stroke-width="3" marker-end="url(#arrowblue)"/>
            <text x="860" y="170" fill="#3498db" font-size="11">1</text>
            <text x="750" y="370" fill="#3498db" font-size="11">*</text>

            <!-- users to user_stats -->
            <line x1="150" y1="310" x2="150" y2="420" stroke="#2ecc71" stroke-width="3" stroke-dasharray="5,5" marker-end="url(#arrowgreen)"/>
            <text x="160" y="360" fill="#2ecc71" font-size="11">1:1</text>
            <text x="165" y="380" fill="#7f8c8d" font-size="10">aggregates</text>

            <!-- users to timeline_cache -->
            <line x1="270" y1="250" x2="870" y2="400" stroke="#3498db" stroke-width="3" marker-end="url(#arrowblue)"/>

            <!-- posts to timeline_cache -->
            <line x1="1000" y1="220" x2="1000" y2="340" stroke="#3498db" stroke-width="3" marker-end="url(#arrowblue)"/>

            <defs>
                <marker id="arrowgreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                    <path d="M0,0 L0,6 L9,3 z" fill="#2ecc71"/>
                </marker>
            </defs>
        </svg>

        <div style="position: relative; height: 600px;">
            <!-- users table -->
            <div class="er-table" style="position: absolute; left: 20px; top: 80px;">
                <div class="er-table-header">users</div>
                <div class="er-table-body">
                    <div class="er-column pk">
                        <span class="er-column-name">ðŸ”‘ id</span>
                        <span class="er-column-type">SERIAL</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">username</span>
                        <span class="er-column-type">VARCHAR(50)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">...</span>
                        <span class="er-column-type"></span>
                    </div>
                </div>
            </div>

            <!-- follows table -->
            <div class="er-table" style="position: absolute; left: 470px; top: 80px;">
                <div class="er-table-header">follows</div>
                <div class="er-table-body">
                    <div class="er-column pk">
                        <span class="er-column-name">ðŸ”‘ id</span>
                        <span class="er-column-type">SERIAL</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— follower_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— following_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">status</span>
                        <span class="er-column-type">VARCHAR(20)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">notifications_enabled</span>
                        <span class="er-column-type">BOOLEAN</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">created_at</span>
                        <span class="er-column-type">TIMESTAMP</span>
                    </div>
                </div>
            </div>

            <!-- shares table -->
            <div class="er-table" style="position: absolute; left: 470px; top: 320px;">
                <div class="er-table-header">shares</div>
                <div class="er-table-body">
                    <div class="er-column pk">
                        <span class="er-column-name">ðŸ”‘ id</span>
                        <span class="er-column-type">SERIAL</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— user_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— post_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">share_type</span>
                        <span class="er-column-type">VARCHAR(20)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">share_comment</span>
                        <span class="er-column-type">TEXT</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">created_at</span>
                        <span class="er-column-type">TIMESTAMP</span>
                    </div>
                </div>
            </div>

            <!-- user_stats table -->
            <div class="er-table" style="position: absolute; left: 20px; top: 420px;">
                <div class="er-table-header" style="background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);">user_stats</div>
                <div class="er-table-body">
                    <div class="er-column pk fk">
                        <span class="er-column-name">ðŸ”‘ user_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">follower_count</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">following_count</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">post_count</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">engagement_score</span>
                        <span class="er-column-type">DECIMAL</span>
                    </div>
                </div>
            </div>

            <!-- posts table -->
            <div class="er-table" style="position: absolute; left: 870px; top: 80px;">
                <div class="er-table-header">posts</div>
                <div class="er-table-body">
                    <div class="er-column pk">
                        <span class="er-column-name">ðŸ”‘ id</span>
                        <span class="er-column-type">SERIAL</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">content</span>
                        <span class="er-column-type">TEXT</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">...</span>
                        <span class="er-column-type"></span>
                    </div>
                </div>
            </div>

            <!-- timeline_cache table -->
            <div class="er-table" style="position: absolute; left: 870px; top: 340px;">
                <div class="er-table-header" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">timeline_cache</div>
                <div class="er-table-body">
                    <div class="er-column pk">
                        <span class="er-column-name">ðŸ”‘ id</span>
                        <span class="er-column-type">SERIAL</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— user_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— post_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">score</span>
                        <span class="er-column-type">DECIMAL</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">reason</span>
                        <span class="er-column-type">VARCHAR(50)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">expires_at</span>
                        <span class="er-column-type">TIMESTAMP</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <h3>Social Features Summary</h3>
    <p><strong>4 Tables:</strong> follows, shares, user_stats (denormalized), timeline_cache</p>
    <p><strong>Key Features:</strong> Self-referencing follows (user follows user), post sharing with types (repost/quote), automated stat aggregation, timeline scoring algorithm (0-100 points)</p>
    <p><strong>Automation:</strong> Triggers auto-update follower/following counts and share counts</p>
</div>

<!-- GROUP SYSTEM ER DIAGRAM -->
<div class="page">
    <h2>Group System - Entity Relationship Diagram</h2>

    <div class="er-diagram" style="min-height: 700px;">
        <svg width="100%" height="700" viewBox="0 0 1300 700">
            <!-- groups to group_memberships -->
            <line x1="180" y1="200" x2="350" y2="200" stroke="#3498db" stroke-width="3" marker-end="url(#arrowblue)"/>
            <text x="240" y="190" fill="#3498db" font-size="11">1:*</text>

            <!-- users to group_memberships -->
            <line x1="530" y1="90" x2="470" y2="140" stroke="#3498db" stroke-width="3" marker-end="url(#arrowblue)"/>
            <text x="490" y="110" fill="#3498db" font-size="11">1:*</text>

            <!-- groups to group_posts -->
            <line x1="90" y1="350" x2="90" y2="430" stroke="#3498db" stroke-width="3" marker-end="url(#arrowblue)"/>
            <text x="100" y="390" fill="#3498db" font-size="11">1:*</text>

            <!-- group_posts to group_comments -->
            <line x1="210" y1="540" x2="350" y2="540" stroke="#3498db" stroke-width="3" marker-end="url(#arrowblue)"/>
            <text x="260" y="530" fill="#3498db" font-size="11">1:*</text>

            <!-- group_posts to group_votes -->
            <line x1="210" y1="480" x2="700" y2="180" stroke="#e74c3c" stroke-width="2" stroke-dasharray="5,5"/>

            <!-- group_comments to group_votes -->
            <line x1="530" y1="540" x2="700" y2="220" stroke="#e74c3c" stroke-width="2" stroke-dasharray="5,5"/>

            <!-- users to group_votes -->
            <line x1="650" y1="90" x2="730" y2="140" stroke="#3498db" stroke-width="3" marker-end="url(#arrowblue)"/>
        </svg>

        <div style="position: relative; height: 700px;">
            <!-- groups table -->
            <div class="er-table" style="position: absolute; left: 20px; top: 80px;">
                <div class="er-table-header" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">groups</div>
                <div class="er-table-body">
                    <div class="er-column pk">
                        <span class="er-column-name">ðŸ”‘ id</span>
                        <span class="er-column-type">SERIAL</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">name</span>
                        <span class="er-column-type">VARCHAR(100)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">slug</span>
                        <span class="er-column-type">VARCHAR(100)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">display_name</span>
                        <span class="er-column-type">VARCHAR(255)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">description</span>
                        <span class="er-column-type">TEXT</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">avatar_url</span>
                        <span class="er-column-type">VARCHAR(500)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">banner_url</span>
                        <span class="er-column-type">VARCHAR(500)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">visibility</span>
                        <span class="er-column-type">VARCHAR(20)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">member_count</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— creator_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                </div>
            </div>

            <!-- group_memberships table -->
            <div class="er-table" style="position: absolute; left: 350px; top: 140px;">
                <div class="er-table-header" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);">group_memberships</div>
                <div class="er-table-body">
                    <div class="er-column pk">
                        <span class="er-column-name">ðŸ”‘ id</span>
                        <span class="er-column-type">SERIAL</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— group_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— user_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">role</span>
                        <span class="er-column-type">VARCHAR(20)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">status</span>
                        <span class="er-column-type">VARCHAR(20)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">joined_at</span>
                        <span class="er-column-type">TIMESTAMP</span>
                    </div>
                </div>
            </div>

            <!-- users table -->
            <div class="er-table" style="position: absolute; left: 530px; top: 20px;">
                <div class="er-table-header">users</div>
                <div class="er-table-body">
                    <div class="er-column pk">
                        <span class="er-column-name">ðŸ”‘ id</span>
                        <span class="er-column-type">SERIAL</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">username</span>
                        <span class="er-column-type">VARCHAR(50)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">...</span>
                        <span class="er-column-type"></span>
                    </div>
                </div>
            </div>

            <!-- group_posts table -->
            <div class="er-table" style="position: absolute; left: 20px; top: 430px;">
                <div class="er-table-header" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">group_posts</div>
                <div class="er-table-body">
                    <div class="er-column pk">
                        <span class="er-column-name">ðŸ”‘ id</span>
                        <span class="er-column-type">SERIAL</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— group_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— user_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">title</span>
                        <span class="er-column-type">VARCHAR(300)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">content</span>
                        <span class="er-column-type">TEXT</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">upvotes</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">downvotes</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">score</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                </div>
            </div>

            <!-- group_comments table -->
            <div class="er-table" style="position: absolute; left: 350px; top: 470px;">
                <div class="er-table-header" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">group_comments</div>
                <div class="er-table-body">
                    <div class="er-column pk">
                        <span class="er-column-name">ðŸ”‘ id</span>
                        <span class="er-column-type">SERIAL</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— post_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— parent_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— user_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">content</span>
                        <span class="er-column-type">TEXT</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">path</span>
                        <span class="er-column-type">LTREE</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">depth</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">score</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                </div>
            </div>

            <!-- group_votes table -->
            <div class="er-table" style="position: absolute; left: 700px; top: 140px;">
                <div class="er-table-header" style="background: linear-gradient(135deg, #16a085 0%, #1abc9c 100%);">group_votes</div>
                <div class="er-table-body">
                    <div class="er-column pk">
                        <span class="er-column-name">ðŸ”‘ id</span>
                        <span class="er-column-type">SERIAL</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— user_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— post_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— comment_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">vote_type</span>
                        <span class="er-column-type">VARCHAR(10)</span>
                    </div>
                </div>
            </div>

            <!-- group_post_media table -->
            <div class="er-table" style="position: absolute; left: 700px; top: 380px;">
                <div class="er-table-header" style="background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);">group_post_media</div>
                <div class="er-table-body">
                    <div class="er-column pk">
                        <span class="er-column-name">ðŸ”‘ id</span>
                        <span class="er-column-type">SERIAL</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— post_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">file_url</span>
                        <span class="er-column-type">VARCHAR(500)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">media_type</span>
                        <span class="er-column-type">VARCHAR(20)</span>
                    </div>
                </div>
            </div>

            <!-- group_activity_log table -->
            <div class="er-table" style="position: absolute; left: 1020px; top: 160px;">
                <div class="er-table-header" style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);">group_activity_log</div>
                <div class="er-table-body">
                    <div class="er-column pk">
                        <span class="er-column-name">ðŸ”‘ id</span>
                        <span class="er-column-type">SERIAL</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— group_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— user_id</span>
                        <span class="er-column-type">INTEGER</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">action_type</span>
                        <span class="er-column-type">VARCHAR(50)</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">details</span>
                        <span class="er-column-type">JSONB</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <h3>Group System Summary</h3>
    <p><strong>9 Tables:</strong> groups, group_memberships, group_posts, group_comments (ltree), group_votes, group_post_media, group_comment_media, group_invitations, group_activity_log</p>
    <p><strong>Key Features:</strong> Reddit-style communities, role-based permissions (admin/moderator/member), upvote/downvote system, nested comments with ltree paths, media galleries, moderation audit logs</p>
    <p><strong>Automation:</strong> Triggers auto-update vote counts, member counts, and comment counts. ltree paths set automatically on insert.</p>
</div>

<!-- REPUTATION & GEOLOCATION -->
<div class="page">
    <h2>Additional Systems</h2>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px;">
        <!-- Left Column: Reputation System -->
        <div>
            <h3>Reputation System (4 Tables)</h3>
            <div class="er-diagram" style="min-height: 450px;">
                <svg width="100%" height="450" viewBox="0 0 600 450">
                    <line x1="150" y1="100" x2="300" y2="100" stroke="#3498db" stroke-width="2" marker-end="url(#arrowblue)"/>
                    <line x1="150" y1="200" x2="300" y2="200" stroke="#2ecc71" stroke-width="2" stroke-dasharray="5,5"/>
                    <line x1="430" y1="140" x2="430" y2="240" stroke="#e74c3c" stroke-width="2"/>
                </svg>

                <div style="position: relative; height: 450px;">
                    <div class="er-table" style="position: absolute; left: 10px; top: 40px; width: 130px;">
                        <div class="er-table-header">users</div>
                        <div class="er-table-body">
                            <div class="er-column pk">
                                <span class="er-column-name">ðŸ”‘ id</span>
                            </div>
                        </div>
                    </div>

                    <div class="er-table" style="position: absolute; left: 300px; top: 40px; width: 260px;">
                        <div class="er-table-header" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">user_ratings</div>
                        <div class="er-table-body">
                            <div class="er-column pk">
                                <span class="er-column-name">ðŸ”‘ id</span>
                            </div>
                            <div class="er-column fk">
                                <span class="er-column-name">ðŸ”— rater_id</span>
                            </div>
                            <div class="er-column fk">
                                <span class="er-column-name">ðŸ”— rated_user_id</span>
                            </div>
                            <div class="er-column">
                                <span class="er-column-name">rating_value (1-5)</span>
                            </div>
                            <div class="er-column">
                                <span class="er-column-name">review_text</span>
                            </div>
                        </div>
                    </div>

                    <div class="er-table" style="position: absolute; left: 300px; top: 240px; width: 260px;">
                        <div class="er-table-header" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">rating_reports</div>
                        <div class="er-table-body">
                            <div class="er-column pk">
                                <span class="er-column-name">ðŸ”‘ id</span>
                            </div>
                            <div class="er-column fk">
                                <span class="er-column-name">ðŸ”— rating_id</span>
                            </div>
                            <div class="er-column">
                                <span class="er-column-name">report_reason</span>
                            </div>
                        </div>
                    </div>

                    <div class="er-table" style="position: absolute; left: 10px; top: 180px; width: 130px;">
                        <div class="er-table-header" style="background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);">user_reputation</div>
                        <div class="er-table-body">
                            <div class="er-column pk fk">
                                <span class="er-column-name">ðŸ”‘ user_id</span>
                            </div>
                            <div class="er-column">
                                <span class="er-column-name">avg_rating</span>
                            </div>
                            <div class="er-column">
                                <span class="er-column-name">reputation_score</span>
                            </div>
                            <div class="er-column">
                                <span class="er-column-name">reputation_level</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <p style="font-size: 8pt; margin-top: 10px; line-height: 1.5;">
                <strong>Reputation Levels:</strong><br>
                â€¢ newcomer (0-99)<br>
                â€¢ member (100-299)<br>
                â€¢ contributor (300-499)<br>
                â€¢ veteran (500-699)<br>
                â€¢ expert (700-849)<br>
                â€¢ legend (850-1000)
            </p>
        </div>

        <!-- Right Column: Geolocation System -->
        <div>
            <h3>Geolocation System (2 Tables + User Columns)</h3>
            <div class="er-diagram" style="min-height: 450px;">
                <svg width="100%" height="450" viewBox="0 0 600 450">
                    <line x1="300" y1="100" x2="300" y2="200" stroke="#3498db" stroke-width="2"/>
                    <line x1="300" y1="100" x2="150" y2="300" stroke="#2ecc71" stroke-width="2" stroke-dasharray="5,5"/>
                </svg>

                <div style="position: relative; height: 450px;">
                    <div class="er-table" style="position: absolute; left: 200px; top: 40px; width: 200px;">
                        <div class="er-table-header">users</div>
                        <div class="er-table-body">
                            <div class="er-column pk">
                                <span class="er-column-name">ðŸ”‘ id</span>
                            </div>
                            <div class="er-column">
                                <span class="er-column-name">location_latitude</span>
                            </div>
                            <div class="er-column">
                                <span class="er-column-name">location_longitude</span>
                            </div>
                            <div class="er-column">
                                <span class="er-column-name">location_city</span>
                            </div>
                            <div class="er-column">
                                <span class="er-column-name">location_sharing</span>
                            </div>
                        </div>
                    </div>

                    <div class="er-table" style="position: absolute; left: 200px; top: 200px; width: 200px;">
                        <div class="er-table-header" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);">nearby_search_cache</div>
                        <div class="er-table-body">
                            <div class="er-column pk">
                                <span class="er-column-name">ðŸ”‘ id</span>
                            </div>
                            <div class="er-column">
                                <span class="er-column-name">search_lat</span>
                            </div>
                            <div class="er-column">
                                <span class="er-column-name">search_lon</span>
                            </div>
                            <div class="er-column">
                                <span class="er-column-name">radius_miles</span>
                            </div>
                            <div class="er-column">
                                <span class="er-column-name">expires_at</span>
                            </div>
                        </div>
                    </div>

                    <div class="er-table" style="position: absolute; left: 10px; top: 280px; width: 200px;">
                        <div class="er-table-header" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">location_history</div>
                        <div class="er-table-body">
                            <div class="er-column pk">
                                <span class="er-column-name">ðŸ”‘ id</span>
                            </div>
                            <div class="er-column fk">
                                <span class="er-column-name">ðŸ”— user_id</span>
                            </div>
                            <div class="er-column">
                                <span class="er-column-name">location_latitude</span>
                            </div>
                            <div class="er-column">
                                <span class="er-column-name">location_longitude</span>
                            </div>
                            <div class="er-column">
                                <span class="er-column-name">created_at</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <p style="font-size: 8pt; margin-top: 10px; line-height: 1.5;">
                <strong>Features:</strong><br>
                â€¢ Haversine distance formula (no PostGIS)<br>
                â€¢ Privacy controls: exact, city, off<br>
                â€¢ find_nearby_users() function<br>
                â€¢ 15-minute search cache<br>
                â€¢ Last 100 location history per user
            </p>
        </div>
    </div>

    <h3 style="margin-top: 30px;">Interaction Tracking (2 Tables)</h3>
    <div class="er-diagram" style="min-height: 250px;">
        <svg width="100%" height="250" viewBox="0 0 900 250">
            <line x1="200" y1="120" x2="350" y2="120" stroke="#3498db" stroke-width="2" marker-end="url(#arrowblue)"/>
            <line x1="620" y1="120" x2="750" y2="120" stroke="#2ecc71" stroke-width="2" stroke-dasharray="5,5"/>
        </svg>

        <div style="position: relative; height: 250px;">
            <div class="er-table" style="position: absolute; left: 20px; top: 60px; width: 180px;">
                <div class="er-table-header">comments</div>
                <div class="er-table-body">
                    <div class="er-column pk">
                        <span class="er-column-name">ðŸ”‘ id</span>
                    </div>
                </div>
            </div>

            <div class="er-table" style="position: absolute; left: 350px; top: 20px; width: 260px;">
                <div class="er-table-header" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">comment_interactions</div>
                <div class="er-table-body">
                    <div class="er-column pk">
                        <span class="er-column-name">ðŸ”‘ id</span>
                    </div>
                    <div class="er-column fk">
                        <span class="er-column-name">ðŸ”— comment_id</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">interaction_type</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">user_id</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">session_id</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">metadata</span>
                        <span class="er-column-type">JSONB</span>
                    </div>
                </div>
            </div>

            <div class="er-table" style="position: absolute; left: 750px; top: 40px; width: 220px;">
                <div class="er-table-header" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">comment_metrics</div>
                <div class="er-table-body">
                    <div class="er-column pk fk">
                        <span class="er-column-name">ðŸ”‘ comment_id</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">view_count</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">reaction_count</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">engagement_score</span>
                    </div>
                    <div class="er-column">
                        <span class="er-column-name">algorithm_score</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <p style="font-size: 9pt; margin-top: 15px;">
        <strong>Interaction Types:</strong> view, reply, reaction, share, deep_read, quote<br>
        <strong>Auto-Aggregation:</strong> Triggers update comment_metrics on each interaction
    </p>
</div>

<!-- DATABASE SUMMARY -->
<div class="page">
    <h2>Complete Database Schema Summary</h2>

    <div class="stats-grid">
        <div class="stat-card" style="background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);">
            <div class="stat-value">5</div>
            <div class="stat-label">Core Tables</div>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);">
            <div class="stat-value">4</div>
            <div class="stat-label">Social Tables</div>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">
            <div class="stat-value">9</div>
            <div class="stat-label">Group Tables</div>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
            <div class="stat-value">7</div>
            <div class="stat-label">Other Systems</div>
        </div>
    </div>

    <h3>All Tables by Subsystem</h3>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
        <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
            <h4 style="color: #2ecc71; margin-bottom: 10px;">Core System (5)</h4>
            <ul style="margin-left: 20px; line-height: 1.8; font-size: 9pt;">
                <li><strong>users</strong> - User accounts & authentication</li>
                <li><strong>posts</strong> - User-generated content</li>
                <li><strong>comments</strong> - Nested comments (parent_id)</li>
                <li><strong>media</strong> - File attachments</li>
                <li><strong>reactions</strong> - Emoji reactions</li>
            </ul>
        </div>

        <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
            <h4 style="color: #3498db; margin-bottom: 10px;">Social Features (4)</h4>
            <ul style="margin-left: 20px; line-height: 1.8; font-size: 9pt;">
                <li><strong>follows</strong> - User follow relationships</li>
                <li><strong>shares</strong> - Post sharing/reposts</li>
                <li><strong>user_stats</strong> - Denormalized metrics</li>
                <li><strong>timeline_cache</strong> - Scored feeds (0-100)</li>
            </ul>
        </div>

        <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
            <h4 style="color: #9b59b6; margin-bottom: 10px;">Group System (9)</h4>
            <ul style="margin-left: 20px; line-height: 1.8; font-size: 9pt;">
                <li><strong>groups</strong> - Community groups</li>
                <li><strong>group_memberships</strong> - Member roles</li>
                <li><strong>group_posts</strong> - Posts within groups</li>
                <li><strong>group_comments</strong> - ltree nested comments</li>
                <li><strong>group_votes</strong> - Upvote/downvote</li>
                <li><strong>group_post_media</strong> - Post attachments</li>
                <li><strong>group_comment_media</strong> - Comment attachments</li>
                <li><strong>group_invitations</strong> - Invite system</li>
                <li><strong>group_activity_log</strong> - Audit trail</li>
            </ul>
        </div>

        <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
            <h4 style="color: #e74c3c; margin-bottom: 10px;">Other Systems (7)</h4>
            <ul style="margin-left: 20px; line-height: 1.8; font-size: 9pt;">
                <li><strong>user_ratings</strong> - 1-5 star ratings</li>
                <li><strong>user_reputation</strong> - 0-1000 score</li>
                <li><strong>rating_reports</strong> - Dispute system</li>
                <li><strong>helpful_marks</strong> - Helpful content</li>
                <li><strong>comment_interactions</strong> - Tracking events</li>
                <li><strong>comment_metrics</strong> - Aggregated stats</li>
                <li><strong>location_history</strong> - GPS tracking</li>
                <li><strong>nearby_search_cache</strong> - Geo cache</li>
            </ul>
        </div>
    </div>

    <h3 style="margin-top: 30px;">Key Database Features</h3>

    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 15px;">
        <div style="background: #e8f4fd; padding: 15px; border-left: 4px solid #3498db; border-radius: 3px;">
            <h4 style="color: #2980b9; margin-bottom: 8px;">Automatic Denormalization</h4>
            <p style="font-size: 9pt; line-height: 1.6;">
                Triggers automatically maintain counts and scores:
                follower_count, following_count, member_count, upvotes, downvotes, score
            </p>
        </div>

        <div style="background: #e8f8f5; padding: 15px; border-left: 4px solid #16a085; border-radius: 3px;">
            <h4 style="color: #16a085; margin-bottom: 8px;">Nested Comments</h4>
            <p style="font-size: 9pt; line-height: 1.6;">
                Two approaches: parent_id (traditional) and ltree paths (PostgreSQL extension) for efficient tree queries
            </p>
        </div>

        <div style="background: #fef5e7; padding: 15px; border-left: 4px solid #f39c12; border-radius: 3px;">
            <h4 style="color: #e67e22; margin-bottom: 8px;">Scoring Algorithms</h4>
            <p style="font-size: 9pt; line-height: 1.6;">
                Timeline (0-100): relationship + recency + engagement
                Reputation (0-1000): ratings + quality + activity - reports
            </p>
        </div>

        <div style="background: #fdeef4; padding: 15px; border-left: 4px solid #e74c3c; border-radius: 3px;">
            <h4 style="color: #c0392b; margin-bottom: 8px;">Geolocation</h4>
            <p style="font-size: 9pt; line-height: 1.6;">
                Haversine distance formula (no PostGIS required). Privacy controls: exact, city, off. Efficient bounding box filtering
            </p>
        </div>
    </div>

    <h3 style="margin-top: 30px;">Database Extensions & Functions</h3>

    <table style="width: 100%; margin-top: 15px; font-size: 9pt;">
        <tr>
            <th>Extension</th>
            <th>Purpose</th>
            <th>Usage</th>
        </tr>
        <tr>
            <td><strong>uuid-ossp</strong></td>
            <td>UUID generation</td>
            <td>Generating unique tokens and identifiers</td>
        </tr>
        <tr>
            <td><strong>ltree</strong></td>
            <td>Hierarchical data</td>
            <td>Efficient nested comment queries in groups</td>
        </tr>
    </table>

    <h4 style="margin-top: 20px;">Key Stored Functions (32 total)</h4>
    <ul style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 15px 20px; font-size: 9pt; line-height: 1.8;">
        <li><strong>update_updated_at_column()</strong> - Universal timestamp updater</li>
        <li><strong>update_follow_counts()</strong> - Auto-update follower stats</li>
        <li><strong>calculate_distance_miles()</strong> - Haversine formula</li>
        <li><strong>find_nearby_users()</strong> - Geolocation search</li>
        <li><strong>calculate_reputation_score()</strong> - 0-1000 scoring</li>
        <li><strong>update_group_post_votes()</strong> - Vote counting</li>
        <li><strong>set_group_comment_path()</strong> - ltree path management</li>
        <li><strong>is_group_admin()</strong> - Permission helper</li>
    </ul>

    <h4 style="margin-top: 20px;">Triggers (18 total)</h4>
    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-top: 10px;">
        <ul style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-left: 20px; font-size: 8pt; line-height: 1.8;">
            <li>update_users_updated_at</li>
            <li>update_posts_updated_at</li>
            <li>trigger_update_follow_counts</li>
            <li>trigger_update_share_counts</li>
            <li>trigger_update_group_member_count</li>
            <li>trigger_update_group_post_votes</li>
            <li>trigger_update_group_comment_votes</li>
            <li>trigger_set_group_comment_path</li>
            <li>trigger_update_user_reputation</li>
            <li>comment_interaction_metrics_trigger</li>
            <li>trigger_limit_location_history</li>
            <li>+ 7 more timestamp triggers</li>
        </ul>
    </div>

    <div style="margin-top: 30px; padding: 20px; background: #ecf0f1; border-radius: 8px; text-align: center;">
        <p style="font-size: 12pt; color: #2c3e50; margin-bottom: 8px;">
            <strong>Database Schema Documentation</strong>
        </p>
        <p style="font-size: 9pt; color: #7f8c8d;">
            Social Media Posting System â€¢ PostgreSQL 15 â€¢ Generated: <span id="footer-date"></span>
        </p>
    </div>
</div>

<script>
    // Set generation date
    const now = new Date();
    const dateStr = now.toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
    document.getElementById('generation-date').textContent = dateStr;
    document.getElementById('footer-date').textContent = dateStr;
</script>

</body>
</html>